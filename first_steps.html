<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.17"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>DDC: First steps: the heat equation</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">DDC&nbsp;<span id="projectnumber">0.0.0</span></h1>
	<h2 id="projectbrief">a <span class="acronym">d</span>iscrete <span class="acronym">d</span>omain <span class="acronym">c</span>omputation library</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="first_steps.html">Tutorial</a>
	<li><a href="annotated.html">API reference</a>
	<li id="gitlab-ribbon"><a rel="noopener" href="https://github.com/Maison-de-la-Simulation/ddc" target="_blank">Contribute on Github</a></li>
</ul></nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('first_steps.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">First steps: the heat equation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2"></a>
Definition of a mesh</h1>
<div class="fragment"><div class="line">    <span class="comment">// Origin on X</span></div>
<div class="line">    Coordinate&lt;X&gt; <span class="keyword">const</span> min_x(-1.);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Sampling step on X</span></div>
<div class="line">    Coordinate&lt;X&gt; <span class="keyword">const</span> dx(0.02);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Actual mesh on X</span></div>
<div class="line">    init_discretization&lt;DDimX&gt;(min_x - dx, dx);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Origin on Y</span></div>
<div class="line">    Coordinate&lt;Y&gt; <span class="keyword">const</span> min_y(-1.);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Sampling step on Y</span></div>
<div class="line">    Coordinate&lt;Y&gt; <span class="keyword">const</span> dy(0.01);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Actual mesh on Y</span></div>
<div class="line">    init_discretization&lt;DDimY&gt;(min_y - dy, dy);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Two-dimensional mesh on X,Y</span></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md3"></a>
Domain of interest</h1>
<p>We initialize the full and the inner domain using DiscreteVectors that contain information on the spread of points in our space. For the inner domain, we further precise its origin using a DiscreteCoordinate as it is not the same as our space's origin.</p>
<p>Ghost points will be used for stencil computation on inner domain boundaries' points. </p><div class="image">
<img src="domains.png" alt=""/>
<div class="caption">
domains_image</div></div>
   <div class="fragment"><div class="line">    <a class="code" href="classDiscreteDomain.html">DiscreteDomain&lt;DDimX&gt;</a> <span class="keyword">const</span> domain_x(DiscreteVector&lt;DDimX&gt;(nx + 2));</div>
<div class="line">    <a class="code" href="classDiscreteDomain.html">DiscreteDomain&lt;DDimY&gt;</a> <span class="keyword">const</span> domain_y(DiscreteVector&lt;DDimY&gt;(ny + 2));</div>
<div class="line">    <a class="code" href="classDiscreteDomain.html">DiscreteDomain</a> domain_xy(domain_x, domain_y);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDiscreteDomain.html">DiscreteDomain&lt;DDimX&gt;</a> <span class="keyword">const</span> inner_x(domain_x.front() + 1, DiscreteVector&lt;DDimX&gt;(nx));</div>
<div class="line">    <a class="code" href="classDiscreteDomain.html">DiscreteDomain&lt;DDimY&gt;</a> <span class="keyword">const</span> inner_y(domain_y.front() + 1, DiscreteVector&lt;DDimY&gt;(ny));</div>
<div class="line">    <a class="code" href="classDiscreteDomain.html">DiscreteDomain</a> inner_xy(inner_x, inner_y);</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md4"></a>
Memory allocation</h1>
<p>We allocate two 2D Chunks along the X and Y dimensions which will be used to map temperature to the domains' points at t and t+dt.</p>
<div class="fragment"><div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunk">Chunk&lt;double, DiscreteDomain&lt;DDimX, DDimY&gt;</a>&gt; T_in(domain_xy);</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunk">Chunk&lt;double, DiscreteDomain&lt;DDimX, DDimY&gt;</a>&gt; T_out(domain_xy);</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md5"></a>
Subdomains</h1>
<p>We define ChunkSpans corresponding to the inner and ghost borders. These will be used for the periodic boundary conditions. </p><div class="fragment"><div class="line">    <span class="comment">// Ghost borders</span></div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_g_x_left = T_in[domain_x.front()][inner_y];</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_g_x_right = T_in[domain_x.back()][inner_y];</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_g_y_left = T_in[domain_y.front()][inner_x];</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_g_y_right = T_in[domain_y.back()][inner_x];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Inner borders</span></div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_i_x_left = std::as_const(T_in)[inner_x.front()][inner_y];</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_i_x_right = std::as_const(T_in)[inner_x.back()][inner_y];</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_i_y_left = std::as_const(T_in)[inner_y.front()][inner_x];</div>
<div class="line">    <a class="code" href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a> <span class="keyword">const</span> temperature_i_y_right = std::as_const(T_in)[inner_y.back()][inner_x];</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md6"></a>
Numerical scheme</h1>
<p>Within a time loop, we update the ghost points, apply the numerical scheme over the inner domain and store the result in T_out. </p><div class="fragment"><div class="line">        <span class="comment">// Periodic boundary conditions</span></div>
<div class="line">        deepcopy(temperature_g_x_left, temperature_i_x_right);</div>
<div class="line">        deepcopy(temperature_g_x_right, temperature_i_x_left);</div>
<div class="line">        deepcopy(temperature_g_y_left, temperature_i_y_right);</div>
<div class="line">        deepcopy(temperature_g_y_right, temperature_i_y_left);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Stencil computation on inner domain `inner_xy`</span></div>
<div class="line">        for_each(inner_xy, [&amp;](DiscreteCoordinate&lt;DDimX, DDimY&gt; <span class="keyword">const</span> ixy) {</div>
<div class="line">            DiscreteCoordinate&lt;DDimX&gt; <span class="keyword">const</span> ix = select&lt;DDimX&gt;(ixy);</div>
<div class="line">            DiscreteCoordinate&lt;DDimY&gt; <span class="keyword">const</span> iy = select&lt;DDimY&gt;(ixy);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dx_l = distance_at_left(ix);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dx_r = distance_at_right(ix);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dx_m = 0.5 * (dx_l + dx_r);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dy_l = distance_at_left(iy);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dy_r = distance_at_right(iy);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dy_m = 0.5 * (dy_l + dy_r);</div>
<div class="line">            T_out(ix, iy) = T_in(ix, iy);</div>
<div class="line">            T_out(ix, iy) += kx * dt</div>
<div class="line">                             * (dx_l * T_in(ix + 1, iy) - 2.0 * dx_m * T_in(ix, iy)</div>
<div class="line">                                + dx_r * T_in(ix - 1, iy))</div>
<div class="line">                             / (dx_l * dx_m * dx_r);</div>
<div class="line">            T_out(ix, iy) += ky * dt</div>
<div class="line">                             * (dy_l * T_in(ix, iy + 1) - 2.0 * dy_m * T_in(ix, iy)</div>
<div class="line">                                + dy_r * T_in(ix, iy - 1))</div>
<div class="line">                             / (dy_l * dy_m * dy_r);</div>
<div class="line">        });</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md7"></a>
IO</h1>
<div class="fragment"><div class="line">        <a class="code" href="classPdiEvent.html">PdiEvent</a>(<span class="stringliteral">&quot;temperature&quot;</span>).<a class="code" href="classPdiEvent.html#ab9850d319f22d470db5d395a80c315a0">with</a>(<span class="stringliteral">&quot;iter&quot;</span>, iter).<a class="code" href="classPdiEvent.html#a418674b56f3229f3d2b6eed12177dd5c">and_with</a>(<span class="stringliteral">&quot;temperature&quot;</span>, T_in);</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclassPdiEvent_html_a418674b56f3229f3d2b6eed12177dd5c"><div class="ttname"><a href="classPdiEvent.html#a418674b56f3229f3d2b6eed12177dd5c">PdiEvent::and_with</a></div><div class="ttdeci">PdiEvent &amp; and_with(std::string const &amp;name, T &amp;&amp;t)</div><div class="ttdef"><b>Definition:</b> pdi.hpp:69</div></div>
<div class="ttc" id="anamespace_3globalScope_4_html_classChunkSpan"><div class="ttname"><a href="namespace_3globalScope_4.html#classChunkSpan">ChunkSpan</a></div><div class="ttdef"><b>Definition:</b> chunk_span.hpp:22</div></div>
<div class="ttc" id="aclassPdiEvent_html"><div class="ttname"><a href="classPdiEvent.html">PdiEvent</a></div><div class="ttdef"><b>Definition:</b> pdi.hpp:21</div></div>
<div class="ttc" id="aclassDiscreteDomain_html"><div class="ttname"><a href="classDiscreteDomain.html">DiscreteDomain</a></div><div class="ttdef"><b>Definition:</b> discrete_domain.hpp:17</div></div>
<div class="ttc" id="anamespace_3globalScope_4_html_classChunk"><div class="ttname"><a href="namespace_3globalScope_4.html#classChunk">Chunk</a></div><div class="ttdef"><b>Definition:</b> chunk.hpp:11</div></div>
<div class="ttc" id="aclassPdiEvent_html_ab9850d319f22d470db5d395a80c315a0"><div class="ttname"><a href="classPdiEvent.html#ab9850d319f22d470db5d395a80c315a0">PdiEvent::with</a></div><div class="ttdeci">PdiEvent &amp; with(std::string const &amp;name, BorrowedChunk &amp;&amp;data)</div><div class="ttdef"><b>Definition:</b> pdi.hpp:37</div></div>
</body>
</html>
