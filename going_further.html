<!--
Copyright (C) The DDC development team, see COPYRIGHT.md file
SPDX-License-Identifier: MIT
-->
<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DDC: Commented example: the non uniform heat equation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
</script>
</head>
<body>
<a href="https://github.com/CExA-project/ddc" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
  <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign">
   <div id="projectname">DDC<span id="projectnumber">&#160;0.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('going_further.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Commented example: the non uniform heat equation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In <a class="el" href="non_uniform_heat_equation.html">examples/non_uniform_heat_equation.cpp</a> is a DDC example implementing a forward finite-difference solver for the heat equation over a rectangle 2D domain with periodic boundary conditions and non-uniform space discretization.</p>
<p>As usual, the file starts with a few includes that will be used in the code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;ddc/ddc.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Kokkos_Core.hpp&gt;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
Differences with the uniform problem resolution</h1>
<p>For non-uniform discretization, differences arise compared to uniform discretization, particularly in terms of dimension labeling, domain construction, and even in the resolution of the problem.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Dimensions naming</h2>
<p>Just like the uniform case, we start by defining types that we later use to name our dimensions.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>X;</div>
</div><!-- fragment --><p>However, we then define the discretization as non uniform.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>DDimX : <a class="code hl_class" href="classddc_1_1NonUniformPointSampling.html">ddc::NonUniformPointSampling</a>&lt;X&gt;</div>
<div class="line">{</div>
<div class="line">};</div>
<div class="ttc" id="aclassddc_1_1NonUniformPointSampling_html"><div class="ttname"><a href="classddc_1_1NonUniformPointSampling.html">ddc::NonUniformPointSampling</a></div><div class="ttdoc">NonUniformPointSampling models a non-uniform discretization of the CDim segment .</div><div class="ttdef"><b>Definition</b> <a href="non__uniform__point__sampling_8hpp_source.html#l00038">non_uniform_point_sampling.hpp:39</a></div></div>
</div><!-- fragment --><p>We do the same thing for the second dimension <code>Y</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Y;</div>
<div class="line"><span class="keyword">struct </span>DDimY : <a class="code hl_class" href="classddc_1_1NonUniformPointSampling.html">ddc::NonUniformPointSampling</a>&lt;Y&gt;</div>
<div class="line">{</div>
<div class="line">};</div>
</div><!-- fragment --><p>And for this case, we kept an uniform discretization for the time dimension.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>T;</div>
<div class="line"><span class="keyword">struct </span>DDimT : <a class="code hl_class" href="classddc_1_1UniformPointSampling.html">ddc::UniformPointSampling</a>&lt;T&gt;</div>
<div class="line">{</div>
<div class="line">};</div>
<div class="ttc" id="aclassddc_1_1UniformPointSampling_html"><div class="ttname"><a href="classddc_1_1UniformPointSampling.html">ddc::UniformPointSampling</a></div><div class="ttdoc">UniformPointSampling models a uniform discretization of the provided continuous dimension.</div><div class="ttdef"><b>Definition</b> <a href="uniform__point__sampling_8hpp_source.html#l00035">uniform_point_sampling.hpp:36</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Domains</h2>
<h3><a class="anchor" id="autotoc_md16"></a>
Dimension X</h3>
<p>Just like the uniform case, we define the main characteristics of the domain.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> x_start = -1.;</div>
<div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> x_end = 1.;</div>
<div class="line">std::size_t <span class="keyword">const</span> nb_x_points = 10;</div>
<div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> kx = .01;</div>
</div><!-- fragment --><p>The first step to create a <code>DiscreteDomain</code> with non-uniform spatial discretization is to create a C++ iterator containing the actual coordinates of the points along each dimension. For tutorial purposes, we have constructed a function <code>generate_random_vector</code> that generates a vector with random data ranging from the lower bound to the higher one to populate our vectors.</p>
<p>For the <code>X</code> dimension, we want to build 4 domains:</p>
<ul>
<li><code>x_domain</code>: the main domain from the start (included) to end (included) but excluding "ghost" points.</li>
<li><code>ghosted_x_domain</code>: the domain including all "ghost" points.</li>
<li><code>x_pre_ghost</code>: the "ghost" points that come before the main domain.</li>
<li><code>x_post_ghost</code>: the "ghost" points that come after the main domain.</li>
</ul>
<p>To do so, we have to create the iterator for the main domain.</p>
<div class="fragment"><div class="line">std::vector&lt;double&gt; <span class="keyword">const</span> x_domain_vect = generate_random_vector(nb_x_points, x_start, x_end);</div>
</div><!-- fragment --><p>For the initialization of ghost points in the non-uniform case, it was necessary to explicitly describe the position of the pre-ghost and post-ghost points. For the pre-ghost, it was necessary to start from the first coordinate along x and subtract the difference between the last and the penultimate coordinate of the x dimension to maintain periodicity. For the post-ghost point, take the last point and add the difference between the first and second points along the x dimension.</p>
<div class="fragment"><div class="line">std::vector&lt;double&gt; <span class="keyword">const</span> x_pre_ghost_vect = periodic_extrapolation_left(1, x_domain_vect);</div>
<div class="line">std::vector&lt;double&gt; <span class="keyword">const</span> x_post_ghost_vect = periodic_extrapolation_right(1, x_domain_vect);</div>
</div><!-- fragment --><p>Then we can create our 4 domains using the <code>init_discretization</code> function with the <code>init_ghosted</code> function that takes the vectors as parameters.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> [x_domain, ghosted_x_domain, x_pre_ghost, x_post_ghost]</div>
<div class="line">        = <a class="code hl_function" href="namespaceddc.html#a70f12a43ed0afbc092f4e974b024db3d">ddc::init_discrete_space&lt;DDimX&gt;</a>(</div>
<div class="line">                DDimX::init_ghosted&lt;DDimX&gt;(x_domain_vect, x_pre_ghost_vect, x_post_ghost_vect));</div>
<div class="ttc" id="anamespaceddc_html_a70f12a43ed0afbc092f4e974b024db3d"><div class="ttname"><a href="namespaceddc.html#a70f12a43ed0afbc092f4e974b024db3d">ddc::init_discrete_space</a></div><div class="ttdeci">void init_discrete_space(Args &amp;&amp;... args)</div><div class="ttdoc">Initialize (emplace) a global singleton discrete space.</div><div class="ttdef"><b>Definition</b> <a href="discrete__space_8hpp_source.html#l00154">discrete_space.hpp:154</a></div></div>
</div><!-- fragment --><p><b>To summarize,</b> in this section we saw how to build a domain with non-uniform space discretization:</p>
<ul>
<li>Create an iterator for your domain.</li>
<li>Call the <code>init_discretization</code>Â function with <code>init_ghosted</code> if you need ghost points or with <code>init</code> for a regular domain.</li>
</ul>
<h3><a class="anchor" id="autotoc_md17"></a>
Dimension Y</h3>
<p>For the <code>Y</code> dimension, we do the same. We start by defining our 3 vectors.</p>
<div class="fragment"><div class="line">std::vector&lt;double&gt; <span class="keyword">const</span> y_domain_vect = generate_random_vector(nb_y_points, y_start, y_end);</div>
<div class="line"> </div>
<div class="line">std::vector&lt;double&gt; <span class="keyword">const</span> y_pre_ghost_vect = periodic_extrapolation_left(1, y_domain_vect);</div>
<div class="line">std::vector&lt;double&gt; <span class="keyword">const</span> y_post_ghost_vect = periodic_extrapolation_right(1, y_domain_vect);</div>
</div><!-- fragment --><p>And we use them to build the 4 domains in the same way as for the X dimension.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> [y_domain, ghosted_y_domain, y_pre_ghost, y_post_ghost]</div>
<div class="line">        = <a class="code hl_function" href="namespaceddc.html#a70f12a43ed0afbc092f4e974b024db3d">ddc::init_discrete_space&lt;DDimY&gt;</a>(</div>
<div class="line">                DDimY::init_ghosted&lt;DDimY&gt;(y_domain_vect, y_pre_ghost_vect, y_post_ghost_vect));</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Time dimension</h3>
<p>Then we handle the domains for the simulated time dimension. We first give the simulated time at which to start and end the simulation.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> start_time = 0.;</div>
<div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> end_time = 10.;</div>
</div><!-- fragment --><p>The CFL conditions are more challenging to achieve for the case of non-uniform discretization. Since the spatial steps are not uniform, we first need to find the maximum of the inverse of the square of the spatial step for the <code>X</code> and <code>Y</code> dimensions. And then we obtain the minimum value for <code>dt</code>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> invdx2_max = <a class="code hl_function" href="namespaceddc.html#aa89bc28d3c56d7127ac57fc05bfd01e6">ddc::transform_reduce</a>(</div>
<div class="line">        x_domain,</div>
<div class="line">        0.,</div>
<div class="line">        <a class="code hl_struct" href="structddc_1_1reducer_1_1max.html">ddc::reducer::max&lt;double&gt;</a>(),</div>
<div class="line">        [](<a class="code hl_class" href="classddc_1_1DiscreteElement.html">ddc::DiscreteElement&lt;DDimX&gt;</a> ix) {</div>
<div class="line">            <span class="keywordflow">return</span> 1. / (<a class="code hl_function" href="namespaceddc.html#a9a6e577fbbb7ead9dbe81a3c46c26592">ddc::distance_at_left</a>(ix) * <a class="code hl_function" href="namespaceddc.html#af78ae4219dfa28ce02622005e8a06b41">ddc::distance_at_right</a>(ix));</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> <span class="keyword">const</span> invdy2_max = <a class="code hl_function" href="namespaceddc.html#aa89bc28d3c56d7127ac57fc05bfd01e6">ddc::transform_reduce</a>(</div>
<div class="line">        y_domain,</div>
<div class="line">        0.,</div>
<div class="line">        <a class="code hl_struct" href="structddc_1_1reducer_1_1max.html">ddc::reducer::max&lt;double&gt;</a>(),</div>
<div class="line">        [](<a class="code hl_class" href="classddc_1_1DiscreteElement.html">ddc::DiscreteElement&lt;DDimY&gt;</a> iy) {</div>
<div class="line">            <span class="keywordflow">return</span> 1. / (<a class="code hl_function" href="namespaceddc.html#a9a6e577fbbb7ead9dbe81a3c46c26592">ddc::distance_at_left</a>(iy) * <a class="code hl_function" href="namespaceddc.html#af78ae4219dfa28ce02622005e8a06b41">ddc::distance_at_right</a>(iy));</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="namespaceddc.html#ac18286f7d289865ee020284651f29bb1">ddc::Coordinate&lt;T&gt;</a> <span class="keyword">const</span> max_dt(.5 / (kx * invdx2_max + ky * invdy2_max));</div>
<div class="ttc" id="aclassddc_1_1DiscreteElement_html"><div class="ttname"><a href="classddc_1_1DiscreteElement.html">ddc::DiscreteElement</a></div><div class="ttdoc">A DiscreteElement identifies an element of the discrete dimension.</div><div class="ttdef"><b>Definition</b> <a href="discrete__element_8hpp_source.html#l00148">discrete_element.hpp:149</a></div></div>
<div class="ttc" id="anamespaceddc_html_a9a6e577fbbb7ead9dbe81a3c46c26592"><div class="ttname"><a href="namespaceddc.html#a9a6e577fbbb7ead9dbe81a3c46c26592">ddc::distance_at_left</a></div><div class="ttdeci">KOKKOS_FUNCTION Coordinate&lt; typename DDim::continuous_dimension_type &gt; distance_at_left(DiscreteElement&lt; DDim &gt; i)</div><div class="ttdef"><b>Definition</b> <a href="non__uniform__point__sampling_8hpp_source.html#l00221">non_uniform_point_sampling.hpp:221</a></div></div>
<div class="ttc" id="anamespaceddc_html_aa89bc28d3c56d7127ac57fc05bfd01e6"><div class="ttname"><a href="namespaceddc.html#aa89bc28d3c56d7127ac57fc05bfd01e6">ddc::transform_reduce</a></div><div class="ttdeci">T transform_reduce(Support const &amp;domain, T neutral, BinaryReductionOp &amp;&amp;reduce, UnaryTransformOp &amp;&amp;transform) noexcept</div><div class="ttdoc">A reduction over a nD domain in serial.</div><div class="ttdef"><b>Definition</b> <a href="transform__reduce_8hpp_source.html#l00061">transform_reduce.hpp:61</a></div></div>
<div class="ttc" id="anamespaceddc_html_ac18286f7d289865ee020284651f29bb1"><div class="ttname"><a href="namespaceddc.html#ac18286f7d289865ee020284651f29bb1">ddc::Coordinate</a></div><div class="ttdeci">detail::TaggedVector&lt; CoordinateElement, CDims... &gt; Coordinate</div><div class="ttdoc">A Coordinate represents a coordinate in the continuous space.</div><div class="ttdef"><b>Definition</b> <a href="coordinate_8hpp_source.html#l00029">coordinate.hpp:29</a></div></div>
<div class="ttc" id="anamespaceddc_html_af78ae4219dfa28ce02622005e8a06b41"><div class="ttname"><a href="namespaceddc.html#af78ae4219dfa28ce02622005e8a06b41">ddc::distance_at_right</a></div><div class="ttdeci">KOKKOS_FUNCTION Coordinate&lt; typename DDim::continuous_dimension_type &gt; distance_at_right(DiscreteElement&lt; DDim &gt; i)</div><div class="ttdef"><b>Definition</b> <a href="non__uniform__point__sampling_8hpp_source.html#l00228">non_uniform_point_sampling.hpp:228</a></div></div>
<div class="ttc" id="astructddc_1_1reducer_1_1max_html"><div class="ttname"><a href="structddc_1_1reducer_1_1max.html">ddc::reducer::max</a></div><div class="ttdef"><b>Definition</b> <a href="reducer_8hpp_source.html#l00110">reducer.hpp:111</a></div></div>
</div><!-- fragment --><p>We can calculate the number of time steps and build the <code>DiscreteDomain</code> for the time dimension.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classddc_1_1DiscreteVector.html">ddc::DiscreteVector&lt;DDimT&gt;</a> <span class="keyword">const</span> nb_time_steps(</div>
<div class="line">        std::ceil((end_time - start_time) / max_dt) + .2);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classddc_1_1DiscreteDomain.html">ddc::DiscreteDomain&lt;DDimT&gt;</a> <span class="keyword">const</span> time_domain</div>
<div class="line">        = <a class="code hl_function" href="namespaceddc.html#a70f12a43ed0afbc092f4e974b024db3d">ddc::init_discrete_space&lt;DDimT&gt;</a>(DDimT::init&lt;DDimT&gt;(</div>
<div class="line">                <a class="code hl_typedef" href="namespaceddc.html#ac18286f7d289865ee020284651f29bb1">ddc::Coordinate&lt;T&gt;</a>(start_time),</div>
<div class="line">                <a class="code hl_typedef" href="namespaceddc.html#ac18286f7d289865ee020284651f29bb1">ddc::Coordinate&lt;T&gt;</a>(end_time),</div>
<div class="line">                nb_time_steps + 1));</div>
<div class="ttc" id="aclassddc_1_1DiscreteDomain_html"><div class="ttname"><a href="classddc_1_1DiscreteDomain.html">ddc::DiscreteDomain</a></div><div class="ttdef"><b>Definition</b> <a href="discrete__domain_8hpp_source.html#l00061">discrete_domain.hpp:62</a></div></div>
<div class="ttc" id="aclassddc_1_1DiscreteVector_html"><div class="ttname"><a href="classddc_1_1DiscreteVector.html">ddc::DiscreteVector</a></div><div class="ttdoc">A DiscreteVector is a vector in the discrete dimension.</div><div class="ttdef"><b>Definition</b> <a href="discrete__vector_8hpp_source.html#l00256">discrete_vector.hpp:257</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Time loop</h2>
<p>Allocation and initialization are the same as for the uniform case. Let's focus on resolving the numerical scheme. The main difference in solving the numerical equation is that we need to account for the fact that the values of dx and dy on the left and right sides are different. We use the functions <code>distance_at_left</code> and <code>distance_at_right</code> to solve the equation.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="namespaceddc.html#ad92ed4439bc27c12aba3e0784dc369d4">ddc::parallel_for_each</a>(</div>
<div class="line">        next_temp.domain(),</div>
<div class="line">        KOKKOS_LAMBDA(<a class="code hl_class" href="classddc_1_1DiscreteElement.html">ddc::DiscreteElement&lt;DDimX, DDimY&gt;</a> <span class="keyword">const</span> ixy) {</div>
<div class="line">            <a class="code hl_class" href="classddc_1_1DiscreteElement.html">ddc::DiscreteElement&lt;DDimX&gt;</a> <span class="keyword">const</span> ix(ixy);</div>
<div class="line">            <a class="code hl_class" href="classddc_1_1DiscreteElement.html">ddc::DiscreteElement&lt;DDimY&gt;</a> <span class="keyword">const</span> iy(ixy);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dx_l = <a class="code hl_function" href="namespaceddc.html#a9a6e577fbbb7ead9dbe81a3c46c26592">ddc::distance_at_left</a>(ix);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dx_r = <a class="code hl_function" href="namespaceddc.html#af78ae4219dfa28ce02622005e8a06b41">ddc::distance_at_right</a>(ix);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dx_m = 0.5 * (dx_l + dx_r);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dy_l = <a class="code hl_function" href="namespaceddc.html#a9a6e577fbbb7ead9dbe81a3c46c26592">ddc::distance_at_left</a>(iy);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dy_r = <a class="code hl_function" href="namespaceddc.html#af78ae4219dfa28ce02622005e8a06b41">ddc::distance_at_right</a>(iy);</div>
<div class="line">            <span class="keywordtype">double</span> <span class="keyword">const</span> dy_m = 0.5 * (dy_l + dy_r);</div>
<div class="line">            next_temp(ix, iy) = last_temp(ix, iy);</div>
<div class="line">            next_temp(ix, iy)</div>
<div class="line">                    += kx * <a class="code hl_function" href="namespaceddc.html#a70f12a43ed0afbc092f4e974b024db3d">ddc::step&lt;DDimT&gt;</a>()</div>
<div class="line">                       * (dx_l * last_temp(ix + 1, iy) - 2.0 * dx_m * last_temp(ix, iy)</div>
<div class="line">                          + dx_r * last_temp(ix - 1, iy))</div>
<div class="line">                       / (dx_l * dx_m * dx_r);</div>
<div class="line">            next_temp(ix, iy)</div>
<div class="line">                    += ky * <a class="code hl_function" href="namespaceddc.html#a70f12a43ed0afbc092f4e974b024db3d">ddc::step&lt;DDimT&gt;</a>()</div>
<div class="line">                       * (dy_l * last_temp(ix, iy + 1) - 2.0 * dy_m * last_temp(ix, iy)</div>
<div class="line">                          + dy_r * last_temp(ix, iy - 1))</div>
<div class="line">                       / (dy_l * dy_m * dy_r);</div>
<div class="line">        });</div>
<div class="ttc" id="anamespaceddc_html_ad92ed4439bc27c12aba3e0784dc369d4"><div class="ttname"><a href="namespaceddc.html#ad92ed4439bc27c12aba3e0784dc369d4">ddc::parallel_for_each</a></div><div class="ttdeci">void parallel_for_each(std::string const &amp;label, ExecSpace const &amp;execution_space, Support const &amp;domain, Functor &amp;&amp;f) noexcept</div><div class="ttdoc">iterates over a nD domain using a given Kokkos execution space</div><div class="ttdef"><b>Definition</b> <a href="parallel__for__each_8hpp_source.html#l00081">parallel_for_each.hpp:81</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!--
Copyright (C) The DDC development team, see COPYRIGHT.md file
SPDX-License-Identifier: MIT
-->
<!-- HTML footer for doxygen 1.9.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
